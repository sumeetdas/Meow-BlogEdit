angular.module("meow.blog.edit",["ngRoute","blogEditTemplates","ngSanitize","hc.marked","ngMorph"]).config(["$routeProvider",function(e){var t=["$http","$rootScope",function(e,t){return t.meta||t.meta instanceof Object?t.meta:e({method:"GET",url:"/api/meta"}).then(function(e){return e=e.data||{},t.meta={blogsPerPage:e.blogsPerPage||5,username:e.username||"John Doe",tags:e.tags||[],disqus:e.disqus||{},angularSocialShare:e.angularSocialShare||{}},t.meta})}];e.when("/",{controller:"BlogEditCtrl",templateUrl:"blog-edit.list.tpl.html",resolve:{meta:t}}).when("/tag/:tag",{controller:"BlogEditCtrl",templateUrl:"blog-edit.list.tpl.html",resolve:{meta:t}}).when("/query/:query",{controller:"BlogEditCtrl",templateUrl:"blog-edit.list.tpl.html",resolve:{meta:t}})}]).run(["$http","$rootScope","$routeParams","$blogEdit",function(e,t,l,o){function s(e){t.$on("$routeChangeSuccess",function(){l.tag?o.getBlogsByTag(l.tag,function(e){t.blogs=e},e):l.query?o.getBlogsByQuery(l.query,function(e){t.blogs=e},e):o.getBlogs(function(e){t.blogs=e},e)})}t.meta&&t.meta instanceof Object?s(t.meta.blogsPerPage):e.get("/api/meta").then(function(e){return e=e.data||{},e.blogsPerPage}).then(function(e){s(e)})}]),angular.module("meow.blog.edit").service("$blogEdit",["$http",function(e){function t(e){if(e)if("string"==typeof e)try{e=parseInt(e)}catch(t){e=1}else"number"!=typeof e&&(e=1);else e=1;var l=v.length;return l?parseInt(l/e)+(l%e===0?0:1):1}function l(l,o,s){e.get("/api/blogs/tags/"+l).success(function(e){v=e,m=t(s),u=1,"function"==typeof o&&o(v.slice(0,s))}).error(console.error)}function o(l,o,s){e.get("/api/blogs/query/"+l).success(function(e){v=e,m=t(s),u=1,"function"==typeof o&&o(v.slice(0,s))}).error(console.error)}function s(l,o){e.get("/api/blogs").success(function(e){v=e,m=t(o),u=1,"function"==typeof l&&l(v.slice(0,o))}).error(console.error)}function i(t,l){e.get("/api/blogs/posts/"+t.year+"/"+t.month+"/"+t.date+"/"+t.slug).success(function(e){l(e)}).error(console.error)}function a(e,t){u>1&&(u-=1,e(v.slice((u-1)*t,u*t)))}function r(e,t){m>u&&(u+=1,e(v.slice((u-1)*t,u*t)))}function n(e){if("string"!=typeof e)throw new Error("pFileName is not a string");var t=e.split("-"),l=t.shift(),o=t.shift(),s=t.shift(),i=t.join("-");return{year:l,month:o,date:s,slug:i,formattedDate:f[o-1]+" "+parseInt(s)+", "+l}}function c(t){0===b.length?e.get("/tags").success(function(e){(!e||!e instanceof Array)&&(e=["meow","bow"]),b=e,t(e)}).error(console.error):t(b)}function g(t,l){var o=!(t.slug&&t.year&&t.month&&t.date);o?e.post("/api/blogs",t).success(function(e){l("success",e)}).error(function(e){l("error",e)}):e.put("/api/blogs/posts/"+t.year+"/"+t.month+"/"+t.date+"/"+t.slug,t).success(function(e){l("success",e)}).error(function(e){l("error",e)})}function d(t,l){e["delete"]("/api/blogs/posts/"+t.year+"/"+t.month+"/"+t.date+"/"+t.slug).success(function(e){l("success",e)}).error(function(e){l("error",e)})}function p(e,t){e=e||{post:""},e.post=e.post||"";var l={},o=e.post.split("\n"),s=o.length,i=1,a=[];if("<!--"!==o[0].trim())throw new Error('Incorrect format, missing "<!--"');for(;s>i;){var r=o[i].trim();if("-->"===r)break;""!==r?(a.push(r),i+=1):i+=1}if(i===s)throw new Error('Incorrect format, missing "-->"');a=jsyaml.load(a.join("\n"))||{};var n=a["published-date"];n=f[n.getMonth()]+" "+n.getDate()+", "+n.getFullYear(),l.title=a.title,l.subtitle=a.subtitle,l["published-date"]=n,l.post=e.post,l.tags=[],a.tags=a.tags||"";var c=a.tags.split(",");for(var g in c)l.tags.push(c[g].trim());t(l)}var u=1,m=1,v=[],b=[],f=["January","February","March","April","May","June","July","August","September","October","November","December"];return{getCurrentPageNo:function(){return u},getPageCount:function(){return m},getBlogsByTag:l,getBlogsByQuery:o,getBlogs:s,getBlog:i,getPrevBlogs:a,getNextBlogs:r,parseFileName:n,getTags:c,saveBlog:g,deleteBlog:d,previewBlog:p}}]),angular.module("meow.blog.edit").directive("post",["$compile","marked",function(e,t){return{restrict:"A",replace:!0,link:function(l,o,s){l.$watch(s.post,function(s){s&&"string"==typeof s&&0!==s.length&&(o.html(t(s)),e(o.contents())(l))})}}}]).directive("youtube",["$sce",function(e){return{restrict:"E",replace:!0,template:'<div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" allowfullscreen src="{{url}}"/></div>',link:function(t,l,o){t.url=e.trustAsResourceUrl(o.url)}}}]),angular.module("meow.blog.edit").controller("BlogEditCtrl",["$scope","$blogEdit","$location","meta","$timeout","$route","$window",function(e,t,l,o,s,i,a){function r(){return a.innerWidth>=1340?"blog-edit.post.tpl.html":"blog-edit.post.mobile.tpl.html"}e.blogToEdit={},e.blogToDelete={},e.previewBlog={},e.verify={deleteInput:"",deleteDone:!1,blogSaved:!1,incorrectDeleteInput:!1},e.error={blogSaved:!1,blogDeleted:!1},e.message={blogSaved:"The blog has been saved.",blogDeleted:"The blog has been deleted."},e.username=o.username,e.next=function(){t.getNextBlogs(function(t){e.blogs=t},o.blogsPerPage)},e.prev=function(){t.getPrevBlogs(function(t){e.blogs=t},o.blogsPerPage)},e.isFirstPage=function(){return 1===t.getCurrentPageNo()},e.isLastPage=function(){return t.getCurrentPageNo()===t.getPageCount()},e.getFormattedDate=function(e){return t.parseFileName(e.fileName).formattedDate},e.loadBlog=function(l){var o=t.parseFileName(l.fileName);t.getBlog({year:o.year,month:o.month,date:o.date,slug:o.slug},function(t){e.blogToEdit=t,e.getPreviewBlog(t)})},e.deleteBlog=function(l){return e.verify.deleteInput!==l.title?(e.verify.deleteDone=!1,void(e.verify.incorrectDeleteInput=!0)):(l=t.parseFileName(l.fileName),void t.deleteBlog(l,function(t,l){"success"===t?(e.verify.deleteDone=!0,e.message.blogDeleted="The blog has been deleted."):"error"===t&&(e.verify.deleteDone=!1,e.error.deleteDone=!0,e.message.blogDeleted="Error - "+(l?l:""))}))},e.saveBlog=function(l){var o=t.parseFileName(l.fileName);t.saveBlog({post:l.post,year:o.year,month:o.month,date:o.date,slug:l.slug},function(t,l){"success"==t?(e.verify.blogSaved=!0,e.message.blogSaved="The blog has been saved."):"error"==t&&(e.verify.blogSaved=!1,e.error.blogSaved=!0,e.message.blogSaved="Error - "+(l?l:""))})},e.getPreviewBlog=function(l){e.verify.blogSaved=!1,l.title=l.title||"",l.slug=l.slug||l.title.toLocaleLowerCase().replace(/[\W]/g,"-").replace(/[\-]{2,}/g,"-"),l.fileName=l.fileName||"",t.previewBlog(l,function(t){e.previewBlog=t})},e.blogEditSettings={closeEl:".close",overlay:{templateUrl:r()}},e.deleteBlogSettings={closeEl:".close",modal:{templateUrl:"blog-edit.delete.tpl.html"}},e.search=function(){l.url("/query/"+e.query)},e.purgeEditScopeVar=function(){e.verify.blogSaved&&i.reload(),s(function(){e.blogToEdit={},e.previewBlog={},e.verify.blogSaved=!1,e.error.blogSaved=!1,e.message.blogSaved="The blog has been saved"},1e3)},e.purgeDeleteScopeVar=function(){e.verify.deleteDone&&i.reload(),s(function(){e.blogToDelete={},e.verify.deleteDone=!1,e.error.deleteDone=!1,e.verify.deleteInput="",e.verify.incorrectDeleteInput=!1,e.message.blogDeleted="The blog has been deleted"},400)},e.loadBlogToDelete=function(t){e.blogToDelete=t},e.addBlog=function(){e.blogToEdit={};var t=new Date;e.blogToEdit.date=t.getDate(),e.blogToEdit.month=t.getMonth()+1,e.blogToEdit.year=t.getYear();var l=[t.getFullYear(),t.getMonth()+1,t.getDate()].join("-"),o=["<!--","published-date: "+l,"title: New Post","subtitle: ","tags: ","keywords: ","-->","Write your post here..."];e.blogToEdit.post=o.join("\n"),e.getPreviewBlog(e.blogToEdit)},e.mobile={editMode:!0},e.toggleMobileEditMode=function(){e.mobile.editMode=!e.mobile.editMode}}]),angular.module("blogEditTemplates",[]).run(["$templateCache",function(e){e.put("blog-edit.delete.tpl.html",'<div class="deleteModal"> <span class="glyphicon glyphicon-remove close" ng-click="purgeDeleteScopeVar()"></span> <div ng-if="!verify.deleteDone && !error.deleteDone" style="margin-top: 35px;"> <p class="text-info" style="margin-top: 10px;">To permanently delete the blog, please enter its name.</p> <p class="text-danger lead">{{blogToDelete.title}}</p> <input type="text" ng-model="verify.deleteInput" ng-style="verify.incorrectDeleteInput ? {width: \'100%\', color: \'red\', border: \'1px red solid\'} : {width: \'100%\', color: \'black\'}" ng-change="verify.incorrectDeleteInput = false;" style="width: 100%; color: black;"> <button class="btn btn-danger" ng-click="deleteBlog(blogToDelete)" style="width: 100%; margin-top: 15px;">Delete this blog</button> </div> <div ng-if="verify.deleteDone || error.deleteDone" style="margin-top: 45px;"> <h3 ng-class="verify.deleteDone ? \'text-success\' : \'text-danger\'">{{message.blogDeleted}}</h3> </div> </div>'),e.put("blog-edit.list.tpl.html",'<div class="container"> <div class="row"> <div class="col-lg-7 col-lg-offset-2 col-md-12 blog-main"> <div ng-repeat="blog in blogs"> <div class="post-preview" ng-if="blogs"> <h2 class="post-title"> {{blog.title}} </h2> <em class="post-subtitle" ng-if="blog.subtitle"> {{blog.subtitle}} </em> <div class="row"> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"> <span class="glyphicon glyphicon-pencil text-success" ng-morph-overlay="blogEditSettings" ng-click="loadBlog(blog)" style="z-index: 0 !important; cursor: hand;" title="Edit blog"></span> </div> <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8"> </div> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"> <span class="glyphicon glyphicon-remove text-danger pull-right" ng-morph-modal="deleteBlogSettings" ng-click="loadBlogToDelete(blog)" style="cursor: hand;" title="Delete blog"></span> </div> </div> <div class="post-meta">Posted by <a ng-href="/blogs/edit/#/">{{username}}</a> on {{getFormattedDate(blog)}}</div> <div class="post-meta"><span class="glyphicon glyphicon-tags text-info" style="margin-right:5px;"></span> <em ng-repeat="tag in blog.tags"><a class="tag-link" ng-href="/blogs/edit#/tag/{{tag}}">{{tag}}</a>{{$last ? \'\' : \', \'}}</em></div> </div> <hr> </div> <ul class="pager" style="margin-bottom: 25px;"> <li class="previous"> <a ng-if="!isFirstPage()" ng-click="prev()" style="cursor: hand;" title="View previous page">Previous</a> </li> <li class="next"> <a ng-if="!isLastPage()" ng-click="next()" style="cursor: hand;" title="View next page">Next</a> </li> </ul> </div> <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12" style="margin-top: 15px;"> <div class="row"> <div class="col-lg-8 col-md-6 col-sm-6 col-xs-6"> <input type="text" class="form-control" ng-model="query" placeholder="Query" ng-keypress="$event.keyCode === 13 ? search() : angular.noop()"> </div> <div class="col-lg-4 col-md-6 col-sm-6 col-xs-6 center-block"> <button class="btn btn-default center-block" ng-click="search()" title="Search {{query ? \'\\\'\' + query + \'\\\'\' : \'something\'}}">Search</button> </div> </div> <div class="row"> <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"> <hr> </div> </div> <div class="row"> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 center-block"> <button class="btn btn-default center-block" ng-morph-overlay="blogEditSettings" ng-click="addBlog()" title="Add new blog">Add Blog</button> </div> <div class="col-lg-8 col-md-8 col-sm-8 col-xs-6 center-block"> </div> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-4 center-block pull-right"> <a href="/blogs/edit/logout" class="btn btn-default" role="button" title="Logout"><span class="glyphicon glyphicon-log-out"></span></a> </div> </div> </div> </div> <div class="row" style="margin-top: 15px; margin-bottom: 15px;"> <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center"> <p style="font-size: medium">Powered by <a href="https://github.com/sumeetdas1992/Meow" target="_blank">Meow</a></p> </div> </div> </div>'),e.put("blog-edit.post.mobile.tpl.html",'<div class="container" style="background-color:#f8f8ff;" id="post-edit"> <div class="row"> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"> <span class="glyphicon glyphicon-floppy-disk text-success" ng-click="saveBlog(blogToEdit)" style="font-size: 1.8em;" title="Save Blog"></span> </div> <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-center"> <div class="onoffswitch" ng-click="toggleMobileEditMode()"> <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" ng-model="mobile.editMode" checked> <label class="onoffswitch-label" for="myonoffswitch"> <span class="onoffswitch-inner"></span> <span class="onoffswitch-switch"></span> </label> </div> </div> <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-center"> <span style="font-family: avenir, \'avenir next\', helvetica,arial, sans-serif;" ng-if="verify.blogSaved || error.blogSaved" ng-class="verify.blogSaved ? \'text-success\' : \'text-danger\'"> {{message.blogSaved}} </span> </div> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"> <span class="pull-right glyphicon glyphicon-remove text-danger close" ng-click="purgeEditScopeVar()" style="font-size: 1.8em;" title="Close"></span> </div> </div> <div class="row"> <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12" ng-if="mobile.editMode"> <div class="row"> <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center edit-post-column-header"> <span>Edit</span> </div> </div> <div class="row"> <textarea class="form-control col-lg-12 col-md-12 col-sm-12 col-xs-12" ng-change="getPreviewBlog(blogToEdit)" ng-model="blogToEdit.post" style="height: 85vh; width: 100%; color: black; border: 5px black solid;"></textarea> </div> </div> <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12" ng-if="!mobile.editMode"> <div class="row"> <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center edit-post-column-header"> <span>Preview</span> </div> </div> <div class="row"> <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12" style="height: 85vh; width: 100%; overflow: auto; border: 5px black solid;"> <h1>{{previewBlog.title}}</h1> <em class="post-subtitle" ng-if="previewBlog.subtitle"> {{previewBlog.subtitle}} </em> <div post="previewBlog.post"></div> <br> <em class="post-meta">Posted by <a class="tag-link" title="{{username}}">{{username}}</a> on {{previewBlog[\'published-date\']}}</em> <div class="post-meta"><span class="glyphicon glyphicon-tags" style="margin-right:5px;"><em ng-repeat="tag in previewBlog.tags" style="margin-left: 10px;"><a class="tag-link" title="{{tag}}">{{tag}}</a>{{$last ? \'\' : \',\'}}</em></span></div> </div> </div> </div> </div> </div>'),e.put("blog-edit.post.tpl.html",'<div class="container" style="background-color:#f8f8ff;" id="post-edit"> <div class="row" style="margin-top: 10px;"> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"> <span class="glyphicon glyphicon-floppy-disk text-success" ng-click="saveBlog(blogToEdit)" style="font-size: 1.8em; margin-left: -20px;" title="Save Blog"></span> </div> <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 text-center"> <span style="font-family: avenir, \'avenir next\', helvetica,arial, sans-serif;" ng-if="verify.blogSaved || error.blogSaved" ng-class="verify.blogSaved ? \'text-success\' : \'text-danger\'"> {{message.blogSaved}} </span> </div> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"> <span class="pull-right glyphicon glyphicon-remove text-danger close" ng-click="purgeEditScopeVar()" style="font-size: 1.8em; margin-right: -20px;" title="Close"></span> </div> </div> <div class="row"> <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12" style="margin-left: -10px; margin-right: 10px;"> <div class="row"> <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center edit-post-column-header"> <span>Edit</span> </div> </div> <div class="row"> <textarea class="form-control col-lg-12 col-md-12 col-sm-12 col-xs-12" ng-change="getPreviewBlog(blogToEdit)" ng-model="blogToEdit.post" style="height: 85vh; width: 100%; color: black; border: 5px black solid;"></textarea> </div> </div> <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12" style="margin-left: 10px; margin-right: -10px;"> <div class="row"> <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center edit-post-column-header"> <span>Preview</span> </div> </div> <div class="row"> <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="height: 85vh; width: 100%; overflow: auto; border: 5px black solid;"> <h1>{{previewBlog.title}}</h1> <em class="post-subtitle" ng-if="previewBlog.subtitle"> {{previewBlog.subtitle}} </em> <div post="previewBlog.post"></div> <br> <em class="post-meta">Posted by <a class="tag-link" title="{{username}}">{{username}}</a> on {{previewBlog[\'published-date\']}}</em> <div class="post-meta"><span class="glyphicon glyphicon-tags" style="margin-right:5px;"><em ng-repeat="tag in previewBlog.tags" style="margin-left: 10px;"><a class="tag-link" title="{{tag}}">{{tag}}</a>{{$last ? \'\' : \',\'}}</em></span></div> </div> </div> </div> </div> </div>')}]);