angular.module("meow.blog.edit",["ngRoute","blogEditTemplates","ngSanitize","hc.marked","ngMorph"]).config(["$routeProvider",function(e){var t=["$http","$rootScope",function(e,t){return t.meta||t.meta instanceof Object?t.meta:e({method:"GET",url:"/api/meta"}).then(function(e){return e=e.data||{},t.meta={blogsPerPage:e.blogsPerPage||5,username:e.username||"John Doe",tags:e.tags||[],disqus:e.disqus||{},angularSocialShare:e.angularSocialShare||{}},t.meta})}];e.when("/blogs",{controller:"BlogEditCtrl",templateUrl:"blog-edit.list.tpl.html",resolve:{meta:t}}).when("/blogs/tag/:tag",{controller:"BlogEditCtrl",templateUrl:"blog-edit.list.tpl.html",resolve:{meta:t}}).when("/blogs/query/:query",{controller:"BlogEditCtrl",templateUrl:"blog-edit.list.tpl.html",resolve:{meta:t}})}]).run(["$http","$rootScope","$routeParams","$blogEdit",function(e,t,l,o){function r(e){t.$on("$routeChangeSuccess",function(){l.tag?o.getBlogsByTag(l.tag,function(e){t.blogs=e},e):l.query?o.getBlogsByQuery(l.query,function(e){t.blogs=e},e):o.getBlogs(function(e){t.blogs=e},e)})}t.meta&&t.meta instanceof Object?r(t.meta.blogsPerPage):e.get("/api/meta").then(function(e){return e=e.data||{},e.blogsPerPage}).then(function(e){r(e)})}]),angular.module("meow.blog.edit").service("$blogEdit",["$http",function(e){function t(e){if(e)if("string"==typeof e)try{e=parseInt(e)}catch(t){e=1}else"number"!=typeof e&&(e=1);else e=1;var l=m.length;return l?parseInt(l/e)+(l%e===0?0:1):1}function l(l,o,r){e.get("/api/blogs/tags/"+l).success(function(e){m=e,v=t(r),p=1,"function"==typeof o&&o(m.slice(0,r))}).error(console.error)}function o(l,o,r){e.get("/api/blogs/query/"+l).success(function(e){m=e,v=t(r),p=1,"function"==typeof o&&o(m.slice(0,r))}).error(console.error)}function r(l,o){e.get("/api/blogs").success(function(e){m=e,v=t(o),p=1,"function"==typeof l&&l(m.slice(0,o))}).error(console.error)}function n(t,l){e.get("/api/blogs/posts/"+t.year+"/"+t.month+"/"+t.date+"/"+t.slug).success(function(e){l(e)}).error(console.error)}function s(e,t){p>1&&(p-=1,e(m.slice((p-1)*t,p*t)))}function i(e,t){v>p&&(p+=1,e(m.slice((p-1)*t,p*t)))}function a(e){if("string"!=typeof e)throw new Error("pFileName is not a string");var t=e.split("-"),l=t.shift(),o=t.shift(),r=t.shift(),n=t.join("-");return{year:l,month:o,date:r,slug:n,formattedDate:b[o-1]+" "+parseInt(r)+", "+l}}function c(t){0===f.length?e.get("/tags").success(function(e){(!e||!e instanceof Array)&&(e=["meow","bow"]),f=e,t(e)}).error(console.error):t(f)}function g(t,l){var o=!(t.slug&&t.year&&t.month&&t.date);o?e.post("/api/blogs",t).success(function(e){l("success",e)}).error(function(e){l("error",e)}):e.put("/api/blogs/posts/"+t.year+"/"+t.month+"/"+t.date+"/"+t.slug,t).success(function(e){l("success",e)}).error(function(e){l("error",e)})}function d(t,l){e["delete"]("/api/blogs/posts/"+t.year+"/"+t.month+"/"+t.date+"/"+t.slug).success(function(e){l("success",e)}).error(function(e){l("error",e)})}function u(e,t){e=e||{post:""},e.post=e.post||"";var l={},o=e.post.split("\n"),r=o.length,n=1,s=[];if("<!--"!==o[0].trim())throw new Error('Incorrect format, missing "<!--"');for(;r>n;){var i=o[n].trim();if("-->"===i)break;""!==i?(s.push(i),n+=1):n+=1}if(n===r)throw new Error('Incorrect format, missing "-->"');s=jsyaml.load(s.join("\n"))||{};var a=s["published-date"];a=b[a.getMonth()]+" "+a.getDate()+", "+a.getFullYear(),l.title=s.title,l.subtitle=s.subtitle,l["published-date"]=a,l.post=e.post,l.tags=[],s.tags=s.tags||"";var c=s.tags.split(",");for(var g in c)l.tags.push(c[g].trim());t(l)}var p=1,v=1,m=[],f=[],b=["January","February","March","April","May","June","July","August","September","October","November","December"];return{getCurrentPageNo:function(){return p},getPageCount:function(){return v},getBlogsByTag:l,getBlogsByQuery:o,getBlogs:r,getBlog:n,getPrevBlogs:s,getNextBlogs:i,parseFileName:a,getTags:c,saveBlog:g,deleteBlog:d,previewBlog:u}}]),angular.module("meow.blog.edit").directive("post",["$compile","marked",function(e,t){return{restrict:"A",replace:!0,link:function(l,o,r){l.$watch(r.post,function(r){r&&"string"==typeof r&&0!==r.length&&(o.html(t(r)),e(o.contents())(l))})}}}]).directive("youtube",["$sce",function(e){return{restrict:"E",replace:!0,template:'<div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" allowfullscreen src="{{url}}"/></div>',link:function(t,l,o){t.url=e.trustAsResourceUrl(o.url)}}}]),angular.module("meow.blog.edit").controller("BlogEditCtrl",["$scope","$blogEdit","$location","meta","$timeout","$route",function(e,t,l,o,r,n){e.blogToEdit={},e.blogToDelete={},e.previewBlog={},e.verify={deleteInput:"",deleteDone:!1,blogSaved:!1,incorrectDeleteInput:!1},e.error={blogSaved:!1,blogDeleted:!1},e.message={blogSaved:"The blog has been saved.",blogDeleted:"The blog has been deleted."},e.username=o.username,e.next=function(){t.getNextBlogs(function(t){e.blogs=t},o.blogsPerPage)},e.prev=function(){t.getPrevBlogs(function(t){e.blogs=t},o.blogsPerPage)},e.isFirstPage=function(){return 1===t.getCurrentPageNo()},e.isLastPage=function(){return t.getCurrentPageNo()===t.getPageCount()},e.getFormattedDate=function(e){return t.parseFileName(e.fileName).formattedDate},e.loadBlog=function(l){var o=t.parseFileName(l.fileName);t.getBlog({year:o.year,month:o.month,date:o.date,slug:o.slug},function(t){e.blogToEdit=t,e.getPreviewBlog(t)})},e.deleteBlog=function(l){return e.verify.deleteInput!==l.title?(e.verify.deleteDone=!1,void(e.verify.incorrectDeleteInput=!0)):(l=t.parseFileName(l.fileName),void t.deleteBlog(l,function(t,l){"success"===t?e.verify.deleteDone=!0:"error"===t&&(e.verify.deleteDone=!1,e.error.deleteDone=!0,e.message.blogDeleted="Error "+(l?l:""))}))},e.saveBlog=function(l){console.log(l);var o=t.parseFileName(l.fileName);t.saveBlog({post:l.post,year:o.year,month:o.month,date:o.date,slug:l.slug},function(t,l){"success"==t?e.verify.blogSaved=!0:"error"==t&&(e.verify.blogSaved=!1,e.error.blogSaved=!0,e.message.blogSaved="Error "+(l?l:""))})},e.getPreviewBlog=function(l){e.verify.blogSaved=!1,l.title=l.title||"",l.slug=l.slug||l.title.toLocaleLowerCase().replace(/[\W]/g,"-").replace(/[\-]{2,}/g,"-"),l.fileName=l.fileName||"",t.previewBlog(l,function(t){e.previewBlog=t})},e.blogEditSettings={closeEl:".close",overlay:{templateUrl:"blog-edit.post.tpl.html"}},e.deleteBlogSettings={closeEl:".close",modal:{templateUrl:"blog-edit.delete.tpl.html"}},e.search=function(){l.url("/blogs/query/"+e.query)},e.purgeEditScopeVar=function(){e.verify.blogSaved&&n.reload(),r(function(){e.blogToEdit={},e.previewBlog={},e.verify.blogSaved=!1,e.error.blogSaved=!1,e.message.blogSaved="The blog has been saved"},1e3)},e.purgeDeleteScopeVar=function(){e.verify.deleteDone&&n.reload(),r(function(){e.blogToDelete={},e.verify.deleteDone=!1,e.error.deleteDone=!1,e.verify.deleteInput="",e.verify.incorrectDeleteInput=!1,e.message.blogDeleted="The blog has been deleted"},1e3)},e.loadBlogToDelete=function(t){e.blogToDelete=t},e.addBlog=function(){e.blogToEdit={};var t=new Date;e.blogToEdit.date=t.getDate(),e.blogToEdit.month=t.getMonth(),e.blogToEdit.year=t.getYear(),e.blogToEdit.slug="new-post";var l=[t.getFullYear(),t.getMonth(),t.getDate()].join("-"),o=["<!--","published-date: "+l,"title: New Post","subtitle: ","tags: ","keywords: ","-->","Write your post here..."];e.blogToEdit.post=o.join("\n"),e.getPreviewBlog(e.blogToEdit)}}]),angular.module("blogEditTemplates",[]).run(["$templateCache",function(e){e.put("blog-edit.delete.tpl.html",'<div class="container deleteModal">\r\n\r\n    <div class="row">\r\n        <div class="col-lg-10 col-md-10 col-sm-10 col-xs-12">\r\n\r\n        </div>\r\n        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-4 pull-right">\r\n            <span class="glyphicon glyphicon-remove close" ng-click="purgeDeleteScopeVar()" style="font-size: 1.3em; margin-top: 20px;"></span>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="row" ng-if="!verify.deleteDone">\r\n        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">\r\n            <p class="text-info" style="margin-top: 10px;">\r\n                This will permanently delete this blog post. Please enter the name of the blog below to delete it.\r\n            </p>\r\n\r\n            <p class="text-danger lead">{{blogToDelete.title}}</p>\r\n\r\n            <input type="text" ng-model="verify.deleteInput"\r\n                   ng-style="verify.incorrectDeleteInput ? {width: \'100%\', color: \'red\', border: \'1px red solid\'} : {width: \'100%\', color: \'black\'}"\r\n                   ng-change="verify.incorrectDeleteInput = false;" style="width: 100%; color: black;"/>\r\n\r\n            <button class="btn btn-danger" ng-click="deleteBlog(blogToDelete)" style="width: 100%; margin-top: 15px;">Delete this blog</button>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="row" ng-if="verify.deleteDone || error.deleteDone">\r\n        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">\r\n            <h4 ng-class="verify.deleteDone ? \'text-success\' : \'text-danger\'">{{message.blogDeleted}}</h4>\r\n        </div>\r\n    </div>\r\n</div>'),e.put("blog-edit.list.tpl.html",'<div class="container">\r\n    <div class="row">\r\n        <div class="col-lg-7 col-lg-offset-2 col-md-10 col-md-offset-1 blog-main">\r\n            <div ng-repeat="blog in blogs">\r\n\r\n                <div class="post-preview" ng-if="blogs">\r\n\r\n                    <h2 class="post-title">\r\n                        {{blog.title}}\r\n                    </h2>\r\n\r\n                    <em class="post-subtitle" ng-if="blog.subtitle">\r\n                        {{blog.subtitle}}\r\n                    </em>\r\n\r\n                    <div class="row">\r\n                        <div class="col-lg-2 col-md-3 col-sm-4 col-xs-6">\r\n                            <span class="glyphicon glyphicon-pencil text-success" ng-morph-overlay="blogEditSettings" ng-click="loadBlog(blog)" style="font-size: 1.3em; z-index: 0 !important; cursor: hand;"></span>\r\n                        </div>\r\n                        <div class="col-lg-8 col-md-6 col-sm-4 col-xs-6">\r\n\r\n                        </div>\r\n                        <div class="col-lg-2 col-md-3 col-sm-4 col-xs-6">\r\n                            <span class="glyphicon glyphicon-remove text-danger pull-right" ng-morph-modal="deleteBlogSettings" ng-click="loadBlogToDelete(blog)" style="font-size: 1.3em; cursor: hand;"></span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class="post-meta">Posted by <a ng-href="/#/blogs">{{username}}</a> on {{getFormattedDate(blog)}}</div>\r\n                    <div class="post-meta"><span class="glyphicon glyphicon-tags text-info" style="margin-right:5px;"></span> <em ng-repeat="tag in blog.tags"><a class="tag-link" ng-href="/#/blogs/tags/{{tag}}">{{tag}}</a>{{$last ? \'\' : \', \'}}</em></div>\r\n\r\n                </div>\r\n                <hr>\r\n            </div>\r\n            <ul class="pager">\r\n                <li class="previous">\r\n                    <a href="#" ng-if="!isFirstPage()" ng-click="prev()" class="hvr-sweep-to-right">Previous</a>\r\n                </li>\r\n                <li class="next">\r\n                    <a href="#" ng-if="!isLastPage()" ng-click="next()" class="hvr-sweep-to-right">Next</a>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <div class="col-lg-3 col-md-6 col-xs-12">\r\n            <div class="nav-block affix" style="margin-top: 15px;">\r\n                <div class="row">\r\n                    <div class="col-lg-7 col-md-12 col-sm-12 col-xs-12">\r\n                        <input type="text" class="form-control" ng-model="query" placeholder="Type your query here">\r\n                    </div>\r\n                    <div class="col-lg-2 col-md-12 col-sm-12 col-xs-12 center-block">\r\n                        <button class="btn btn-default center-block hvr-sweep-to-right" ng-click="search()">Search</button>\r\n                    </div>\r\n                </div>\r\n                <div class="row">\r\n                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">\r\n                        <hr>\r\n                    </div>\r\n                </div>\r\n                <div class="row">\r\n                    <div class="col-lg-2 col-md-12 col-sm-12 col-xs-12 center-block">\r\n                        <button class="btn btn-default center-block hvr-sweep-to-right" ng-morph-overlay="blogEditSettings" ng-click="addBlog()">Add Blog</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'),e.put("blog-edit.post.tpl.html",'<div class="container" style="background-color:#f8f8ff;" id="post-edit">\r\n    <div class="row" style="margin-top: 10px;">\r\n        <div class="col-lg-2 col-md-3 col-sm-4 col-xs-6">\r\n            <span class="glyphicon glyphicon-floppy-disk text-success" ng-click="saveBlog(blogToEdit)" style="font-size: 1.8em; margin-left: -20px;"></span>\r\n        </div>\r\n        <div class="col-lg-8 col-md-6 col-sm-4 col-xs-12 text-center">\r\n            <span style="font-family: avenir, \'avenir next\', helvetica,arial, sans-serif;" ng-if="verify.blogSaved || error.blogSaved" ng-class="verify.blogSaved ? \'text-success\' : \'text-danger\'">\r\n                {{message.blogSaved}}\r\n            </span>\r\n        </div>\r\n        <div class="col-lg-2 col-md-3 col-sm-4 col-xs-6">\r\n            <span class="pull-right glyphicon glyphicon-remove text-danger close" ng-click="purgeEditScopeVar()" style="font-size: 1.8em; margin-right: -20px;"></span>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="row">\r\n        <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12" style="margin-left: -10px; margin-right: 10px;">\r\n            <div class="row">\r\n                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center edit-post-column-header">\r\n                    <span>Edit</span>\r\n                </div>\r\n            </div>\r\n            <div class="row">\r\n                <textarea class="form-control col-lg-12 col-md-12 col-sm-12 col-xs-12" ng-change="getPreviewBlog(blogToEdit)" ng-model="blogToEdit.post" style="height: 85vh; width: 100%; color: black; border: 5px black solid;"></textarea>\r\n            </div>\r\n        </div>\r\n        <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12" style="margin-left: 10px; margin-right: -10px;">\r\n            <div class="row">\r\n                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center edit-post-column-header">\r\n                    <span>Preview</span>\r\n                </div>\r\n            </div>\r\n            <div class="row">\r\n                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="height: 85vh; width: 100%; overflow: auto; border: 5px black solid;">\r\n                    <h1>{{previewBlog.title}}</h1>\r\n                    <em class="post-subtitle" ng-if="previewBlog.subtitle">\r\n                        {{previewBlog.subtitle}}\r\n                    </em>\r\n                    <div post="previewBlog.post"></div>\r\n                    <br>\r\n                    <em class="post-meta">Posted by <a class="tag-link">{{username}}</a> on {{previewBlog[\'published-date\']}}</em>\r\n                    <div class="post-meta"><span class="glyphicon glyphicon-tags" style="margin-right:5px;"><em ng-repeat="tag in previewBlog.tags"><a class="tag-link">{{tag}}</a>{{$last ? \'\' : \', \'}}</em></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>')}]);